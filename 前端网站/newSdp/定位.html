<!DOCTYPE html>
<!-- saved from url=(0039)http://zhaoziang.com/amap/zero_7_1.html -->
<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

		<title>定位</title>
		<link rel="stylesheet" type="text/css" href="map/zero.css">
		<script src="map/hm.js"></script>
		<script charset="utf-8" src="map/t.js"></script>
		<script language="javascript" src="map/maps"></script>
		<link rel="stylesheet" type="text/css" href="map/style.css">
		<script src="map/main" type="text/javascript" charset="utf-8"></script>
		<!--<style>
	html {
		_background-image: url(about:blank);
		_background-attachment: fixed
	}
</style>-->
		<script type="text/javascript" charset="utf-8" src="map/plugin"></script>
		<script type="text/javascript" charset="utf-8" src="map/plugin(1)"></script>
	</head>

	<body onload="mapInit()" class="">
		<div id="iCenter" class="amap-container amap-fade-anim">
			<div class="amap-maps" style="transform: translate3d(0px, 0px, 0px);">
				<div class="amap-layers">
					<div class="amap-layer" style="z-index: 1;">
						<div class="amap-tile-container amap-zoom-animated" style=""></div>
						<div class="amap-tile-container amap-zoom-animated">
							<img class="amap-tile amap-tile-loaded" style="height: 256px; width: 256px; left: 213px; top: 35px;" src="map/appmaptile"><img class="amap-tile amap-tile-loaded" style="height: 256px; width: 256px; left: 213px; top: 291px;" src="map/appmaptile(1)"><img class="amap-tile amap-tile-loaded" style="height: 256px; width: 256px; left: -43px; top: 291px;" src="map/appmaptile(2)"><img class="amap-tile amap-tile-loaded" style="height: 256px; width: 256px; left: -43px; top: 35px;" src="map/appmaptile(3)"><img class="amap-tile amap-tile-loaded" style="height: 256px; width: 256px; left: 469px; top: 35px;" src="map/appmaptile(4)"><img class="amap-tile amap-tile-loaded" style="height: 256px; width: 256px; left: 469px; top: 291px;" src="map/appmaptile(5)"><img class="amap-tile amap-tile-loaded" style="height: 256px; width: 256px; left: 213px; top: -221px;" src="map/appmaptile(6)"><img class="amap-tile amap-tile-loaded" style="height: 256px; width: 256px; left: 213px; top: 547px;" src="map/appmaptile(7)"><img class="amap-tile amap-tile-loaded" style="height: 256px; width: 256px; left: 469px; top: -221px;" src="map/appmaptile(8)"><img class="amap-tile amap-tile-loaded" style="height: 256px; width: 256px; left: -43px; top: 547px;" src="map/appmaptile(9)"><img class="amap-tile amap-tile-loaded" style="height: 256px; width: 256px; left: -43px; top: -221px;" src="map/appmaptile(10)"><img class="amap-tile amap-tile-loaded" style="height: 256px; width: 256px; left: 469px; top: 547px;" src="map/appmaptile(11)"></div>
					</div>
				</div>
				<div class="amap-overlays"></div>
			</div>
			<div class="amap-controls"></div><img class="amap-logo" src="map/autonavi.png">
			<div class="amap-copyright" style="display: block;">地图数据 ©2014 AutoNavi - GS(2014)6002号</div>
		</div>
		<div id="iControlbox">

			<ul>
				<li>
					<button onclick="javascript:getCurrentPosition();">浏览器定位</button>
				</li>
				<li>
					<button onclick="javascript:showCityInfo();">IP定位</button>
				</li>
				<li>
					<input type="text" id="key_1" value="成都市">
					<button onclick="javascript:placeSearch();">关键字定位</button>
				</li>
				<li>
					<input type="text" id="key_2" value="郑州市中原区">
					<button onclick="javascript:geocoder();">地址定位</button>
				</li>
			</ul>
			<p>坐标：<span id="lnglat">&nbsp;</span></p>
			<p><span id="iAddress">&nbsp;</span></p>
			<!--<p>坐标：x<span id="lnglatx">&nbsp;</span></p>
			<p>坐标：Y<span id="lnglaty">&nbsp;</span></p>-->
		</div>
		<div id="result">您输入的是：绿地新都会</div>
		<!-- tongji begin-->
		<script type="text/javascript">
//			var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
//			document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Faeff88f19045b513af7681b011cea3bd' type='text/javascript'%3E%3C/script%3E"));
		</script>
		<script src="map/h.js" type="text/javascript"></script>
		<!--<a href="http://tongji.baidu.com/hm-web/welcome/ico?s=aeff88f19045b513af7681b011cea3bd" target="_blank"></a>-->
		<!-- tongji end -->

		<script language="javascript">
			var mapObj;
			// var marker;  
			// var marker2;  
			// var marker3;  
			// var cluster;  
			// var markers = []; 
			// var lineArr;
			// var cloudDataLayer;
			//初始化地图对象，加载地图  
			function mapInit() {

			}
			//鼠标点击，获取经纬度坐标  
			function getLnglat(e) {
				var x = e.lnglat.getLng();
				var y = e.lnglat.getLat();
				document.getElementById("lnglat").innerHTML = x + "," + y;
//				document.getElementById("lnglatx").innerHTML = x ;
//				document.getElementById("lnglaty").innerHTML = y;
			}
		</script>
		<script language="javascript">
			var mapObj, geolocation;
			var result;

			function mapInit() {
				// mapObj = new AMap.Map('iCenter');    //默认定位：初始化加载地图时，center及level属性缺省，地图默认显示用户所在城市范围
				mapObj = new AMap.Map("iCenter", {
					center: new AMap.LngLat(113.768041, 34.770243), //地图中心点  
					level: 11 //地图显示的比例尺级别  
					//zoomEnable:false
				});
				AMap.event.addListener(mapObj, 'click', getLnglat); //点击事件 
			};

			function getCurrentPosition() { //调用浏览器定位服务
				mapObj.plugin('AMap.Geolocation', function() {
					geolocation = new AMap.Geolocation({
						enableHighAccuracy: true, //是否使用高精度定位，默认:true
						timeout: 10000, //超过10秒后停止定位，默认：无穷大
						maximumAge: 0, //定位结果缓存0毫秒，默认：0
						convert: true, //自动偏移坐标，偏移后的坐标为高德坐标，默认：true
						showButton: true, //显示定位按钮，默认：true
						buttonPosition: 'LB', //定位按钮停靠位置，默认：'LB'，左下角
						buttonOffset: new AMap.Pixel(10, 20), //定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)
						showMarker: true, //定位成功后在定位到的位置显示点标记，默认：true
						showCircle: true, //定位成功后用圆圈表示定位精度范围，默认：true
						panToLocation: true, //定位成功后将定位到的位置作为地图中心点，默认：true
						zoomToAccuracy: true //定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false
					});
					mapObj.addControl(geolocation);
					AMap.event.addListener(geolocation, 'complete', onComplete); //返回定位信息
					AMap.event.addListener(geolocation, 'error', onError); //返回定位出错信息
				});
			};

			function onComplete(data) { //解析定位结果
				var str = '<p>定位成功</p>';
				str += '<p>经度：' + data.position.getLng() + '</p>';
				str += '<p>纬度：' + data.position.getLat() + '</p>';
				str += '<p>精度：' + data.accuracy + ' 米</p>';
				str += '<p>是否经过偏移：' + (data.isConverted ? '是' : '否') + '</p>';
				result.innerHTML = str;
			};

			function onError(data) { //解析定位错误信息
				var str = '<p>定位失败</p>';
				str += '<p>错误信息：'
				switch(data.info) {
					case 'PERMISSION_DENIED':
						str += '浏览器阻止了定位操作';
						break;
					case 'POSITION_UNAVAILBLE':
						str += '无法获得当前位置';
						break;
					case 'TIMEOUT':
						str += '定位超时';
						break;
					default:
						str += '未知错误';
						break;
				}
				str += '</p>';
				result.innerHTML = str;
			};

			function showCityInfo() { //IP定位
				//加载IP定位插件
				mapObj.plugin(["AMap.CitySearch"], function() {
					//实例化城市查询类
					var citysearch = new AMap.CitySearch();
					//自动获取用户IP，返回当前城市
					citysearch.getLocalCity();
					AMap.event.addListener(citysearch, "complete", function(result) {
						if(result && result.city && result.bounds) {
							var cityinfo = result.city;
							var citybounds = result.bounds;
							document.getElementById('result').innerHTML = "您当前所在城市：" + cityinfo + "";
							//地图显示当前城市
							mapObj.setBounds(citybounds);
						} else {
							document.getElementById('result').innerHTML = "您当前所在城市：" + result.info + "";
						}
					});
					AMap.event.addListener(citysearch, "error", function(result) {
						alert(result.info);
					});
				});
			}
			var MSearch;
			var key_1;

			function placeSearch() { //POI搜索，关键字查询
				key_1 = document.getElementById("key_1").value;
				document.getElementById('result').innerHTML = "您输入的是：" + key_1;
				mapObj.plugin(["AMap.PlaceSearch"], function() { //构造地点查询类  
					MSearch = new AMap.PlaceSearch({
						pageSize: 10,
						pageIndex: 1
					});
					AMap.event.addListener(MSearch, "complete", function(data) {
						var poiArr = data.poiList.pois;
						var lngX = poiArr[0].location.getLng();
						var latY = poiArr[0].location.getLat();
						mapObj.setCenter(new AMap.LngLat(lngX, latY));
					}); //返回地点查询结果		
					MSearch.search(key_1); //关键字查询
				});
			}
			var MGeocoder;
			var key_2;

			function geocoder() { //地理编码返回结果展示
				key_2 = document.getElementById("key_2").value;
				document.getElementById('result').innerHTML = "您输入的是：" + key_2;
				mapObj.plugin(["AMap.Geocoder"], function() { //加载地理编码插件
					MGeocoder = new AMap.Geocoder({
						radius: 1000 //范围，默认：500
					});
					//返回地理编码结果
					AMap.event.addListener(MGeocoder, "complete", function(data) {
						var geocode = data.geocodes;
						var lngX = geocode[0].location.getLng();
						var latY = geocode[0].location.getLat();
						mapObj.setCenter(new AMap.LngLat(lngX, latY));
					});
					MGeocoder.getLocation(key_2); //地理编码
				});
			}
		</script>

		<object id="np-tools-plugin" type="application/x-npHaitaoPlugin" style="position:absolute;left:-9000px;top:-9000px;" width="0" height="0"></object>
		<a data-cltversion="1.0.2" data-cltsource="410023" data-cltuuid="1c3de1626004e0871749d423e40d259a" data-cltats="3" href="javascript:" id="tools-nav-explugin" style="display: none;">//3pcdn.1haitao.com/extension-tools/js/extensionNav.js?v=1456903219826</a>
		<div id="hm_t_1710" style="display: block; margin: 0px; padding: 0px; float: none; clear: none; overflow: hidden; position: fixed; border: 0px; max-width: none; max-height: none; border-radius: 0px; box-shadow: none; transition: none; text-align: left; box-sizing: content-box; bottom: 2px; z-index: 2147483646; right: 2px; width: 36px; height: 173px; background: none;">
			<div style="display: block; margin: 0px; padding: 0px; float: none; clear: none; overflow: hidden; position: relative; border: 0px; max-width: none; max-height: none; border-radius: 0px; box-shadow: none; transition: none; text-align: left; box-sizing: content-box; width: 100%; height: 100%; background: none;"></div>
		</div>
	</body>

</html>