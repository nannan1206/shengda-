/* JavaScript API, amap, AutoNavi Group; */
(function(e){e.Geocoder=function(a){this.opt=a||{};this.url="http://restapi.amap.com/v3/geocode"};e.Geocoder.prototype={getLocation:function(a){a?(a=["address="+a,"key="+e.Conf.key],this._mergeParams(this.opt,{city:"city"},a),a=new e.Http.JSONP(this.url+"/geo"+(0<a.length?"?"+a.join("&"):""),{callback:"callback"}),a.on("complete",this._geocodingComplete,this),a.on("error",this._onError,this)):e.event.trigger(this,"error",{info:"NO_PARAMS"})},setCity:function(a){this.opt.city=a},getAddress:function(a){a instanceof
e.LngLat?(a=["location="+a.toString(),"key="+e.Conf.key],this._mergeParams(this.opt,{radius:"radius",extensions:"extensions"},a),a=new e.Http.JSONP(this.url+"/regeo"+(0<a.length?"?"+a.join("&"):""),{callback:"callback",antiCrab:!0,type_:"REGEO"}),a.on("complete",this._rgeocodingComplete,this),a.on("error",this._onError,this)):e.event.trigger(this,"error",{info:"INVALID_PARAMS"})},_mergeParams:function(a,d,c){for(var b in a)"undefined"!=typeof a[b]&&"undefined"!=typeof d[b]&&c.push(d[b]+"="+a[b])},
_str2LngLat:function(a){a=a.split(",");return new e.LngLat(a[0],a[1])},_parseString:function(a){return"object"==typeof a||"undefined"==typeof a?"":a},_parseInt:function(a){a=parseInt(a,10);return isNaN(a)?0:a},_geocodingComplete:function(a){if(parseInt(a.status,10)){var d={info:a.info,resultNum:a.count,geocodes:[]};if(a.geocodes.length)for(var c=0,b=a.geocodes.length;c<b;c++){var f=a.geocodes[c],f={location:this._str2LngLat(f.location),formattedAddress:this._parseString(f.formatted_address),adcode:this._parseString(f.adcode),
level:this._parseString(f.level),addressComponent:{neighborhood:this._parseString(f.neighborhood.name),building:this._parseString(f.building.name),province:this._parseString(f.province),city:this._parseString(f.city),district:this._parseString(f.district),township:this._parseString(f.township),citycode:this._parseString(f.citycode),street:this._parseString(f.street),streetNumber:this._parseString(f.number)}};d.geocodes.push(f)}else d.info="NO_DATA";e.event.trigger(this,"complete",d)}else e.event.trigger(this,
"error",{info:a.info})},_rgeocodingComplete:function(a){if(parseInt(a.status,10)){var d={info:a.info,regeocode:{addressComponent:{neighborhood:this._parseString(a.regeocode.addressComponent.neighborhood.name),building:this._parseString(a.regeocode.addressComponent.building.name),street:this._parseString(a.regeocode.addressComponent.streetNumber.street),streetNumber:this._parseString(a.regeocode.addressComponent.streetNumber.number),province:this._parseString(a.regeocode.addressComponent.province),
city:this._parseString(a.regeocode.addressComponent.city),district:this._parseString(a.regeocode.addressComponent.district),township:this._parseString(a.regeocode.addressComponent.township)},formattedAddress:this._parseString(a.regeocode.formatted_address),roads:[],crosses:[],pois:[]}};a.regeocode.roads&&(d.regeocode.roads=this._parseRoads(a.regeocode.roads));if(a.regeocode.roadinters){var c=a.regeocode.roadinters;this._isArray(c)||(c=[a.regeocode.roadinters.roadinter]);d.regeocode.crosses=this._parseCross(c)}a.regeocode.pois&&
(d.regeocode.pois=this._parsePOI(a.regeocode.pois));if("undefined"==typeof d.regeocode.formattedAddress||""===d.regeocode.formattedAddress)d.info="NO_DATA";e.event.trigger(this,"complete",d)}else e.event.trigger(this,"error",{info:a.info})},_parsePOI:function(a){for(var d=[],c=0;c<a.length;c++){var b=a[c];d[c]={id:b.id,name:b.name,type:b.type,address:this._parseString(b.address),distance:this._parseInt(b.distance),tel:this._parseString(b.tel),location:this._str2LngLat(b.location)}}return d},_isArray:function(a){return"[object Array]"===
Object.prototype.toString.call(a)},_parseCross:function(a){for(var d=[],c=0;c<a.length;c++){var b=a[c];d[c]={distance:this._parseInt(b.distance),direction:this._parseString(b.direction),first_id:this._parseString(b.first_id),first_name:this._parseString(b.first_name),second_name:this._parseString(b.second_name),second_id:this._parseString(b.second_id),location:this._str2LngLat(b.location)}}return d},_parseRoads:function(a){for(var d=[],c=0;c<a.length;c++){var b=a[c];d[c]={id:b.id,name:b.name,distance:this._parseInt(b.distance),
direction:this._parseString(b.direction),location:this._str2LngLat(b.location)}}return d},_onError:function(a){e.event.trigger(this,"error",{info:"SERVICE_UNAVAILABLE"})}}})(AMap);
